<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Font Size Spot Detection Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background: #f5f5f5;
        }
        .test-container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .test-result {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            font-weight: bold;
        }
        .success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #0056b3;
        }
        input {
            padding: 8px;
            margin: 5px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        .grid-info {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 4px;
            margin: 10px 0;
            font-family: monospace;
        }
    </style>
</head>
<body>
    <h1>Font Size Spot Detection Test</h1>
    <p>This test verifies that the minimum spot detection size matches the mainText font size.</p>

    <div class="test-container">
        <h2>Test Controls</h2>
        <div>
            <label for="fontSize">Font Size:</label>
            <input type="number" id="fontSize" value="48" min="10" max="200">
            <button onclick="runTest()">Run Test</button>
            <button onclick="clearResults()">Clear Results</button>
        </div>
    </div>

    <div class="test-container">
        <h2>Test Results</h2>
        <div id="results"></div>
    </div>

    <div class="test-container">
        <h2>Debug Information</h2>
        <div id="debugInfo"></div>
    </div>

    <!-- Include the main application -->
    <script src="js/text/FontMetrics.js"></script>
    <script src="js/text/TextComponent.js"></script>
    <script src="js/text/TextPositioning.js"></script>
    <script src="js/text/MainTextController.js"></script>
    <script src="js/canvas/CanvasManager.js"></script>
    <script src="js/canvas/DebugController.js"></script>
    <script src="js/parameters/Shuffler.js"></script>
    <script src="js/grid/GridDetector.js"></script>
    <script src="js/content/ContentController.js"></script>
    <script src="js/content/EmptyContentController.js"></script>
    <script src="js/content/TextContentController.js"></script>
    <script src="js/content/ImageContentController.js"></script>
    <script src="js/content/MaskContentController.js"></script>
    <script src="js/grid/Layer.js"></script>
    <script src="js/grid/LayerManager.js"></script>
    <script src="js/grid/GridCell.js"></script>
    <script src="js/grid/MainTextCell.js"></script>
    <script src="js/grid/ContentCell.js"></script>
    <script src="js/grid/CellRenderer.js"></script>
    <script src="js/grid/GridBuilder.js"></script>
    <script src="js/grid/GridSnapshot.js"></script>
    <script src="js/grid/Grid.js"></script>
    <script src="js/animations/CellAnimation.js"></script>
    <script src="js/app.js"></script>

    <script>
        let app = null;

        // Initialize the app when page loads
        window.addEventListener('load', async () => {
            try {
                // Create a mock canvas for testing
                const canvas = document.createElement('canvas');
                canvas.width = 800;
                canvas.height = 600;
                document.body.appendChild(canvas);

                // Initialize the app
                app = new EmployerBrandToolPOC();
                await app.initialize();

                // Set initial text
                app.textEngine.setText('TEST\nSPOT\nDETECTION');
                
                addResult('info', 'Application initialized successfully');
                addDebugInfo('App initialized with canvas size: 800x600');
            } catch (error) {
                addResult('error', `Failed to initialize app: ${error.message}`);
                console.error('Initialization error:', error);
            }
        });

        function runTest() {
            const fontSize = parseInt(document.getElementById('fontSize').value);
            
            if (!app) {
                addResult('error', 'Application not initialized');
                return;
            }

            try {
                // Update font size
                app.mainTextComponent.fontSize = fontSize;
                app.textEngine.updateConfig({ fontSize });
                
                // Rebuild grid to trigger spot detection with new font size
                app.grid.buildFromExisting();
                
                // Get grid information
                const gridInfo = app.gridDetector.getStatistics(app.grid, app.canvasManager.canvas);
                const debugInfo = app.gridDetector.getDebugInfo();
                
                // Check if minimum cell size matches font size
                const minCellSize = app.gridDetector.minCellSize;
                const expectedMinSize = fontSize;
                
                addResult('info', `Testing with font size: ${fontSize}px`);
                addResult('info', `GridDetector minCellSize: ${minCellSize}px`);
                
                if (minCellSize === expectedMinSize) {
                    addResult('success', `✅ PASS: Minimum spot size (${minCellSize}px) matches font size (${fontSize}px)`);
                } else {
                    addResult('error', `❌ FAIL: Minimum spot size (${minCellSize}px) does not match font size (${fontSize}px)`);
                }
                
                // Show grid statistics
                if (gridInfo) {
                    addDebugInfo(`Grid Statistics:
- Total cells: ${gridInfo.totalCells}
- Text cells: ${gridInfo.textCells}
- Content cells: ${gridInfo.contentCells}
- Grid dimensions: ${gridInfo.gridDimensions}
- Text coverage: ${gridInfo.textCoverage}
- Content coverage: ${gridInfo.contentCoverage}`);
                }
                
                if (debugInfo) {
                    addDebugInfo(`Debug Info:
- Canvas size: ${debugInfo.canvasSize}
- Text lines: ${debugInfo.textLines}
- Detected cells: ${debugInfo.detectedCells}
- Detection time: ${debugInfo.detectionTime}ms`);
                }
                
            } catch (error) {
                addResult('error', `Test failed: ${error.message}`);
                console.error('Test error:', error);
            }
        }

        function addResult(type, message) {
            const resultsDiv = document.getElementById('results');
            const resultDiv = document.createElement('div');
            resultDiv.className = `test-result ${type}`;
            resultDiv.textContent = message;
            resultsDiv.appendChild(resultDiv);
        }

        function addDebugInfo(message) {
            const debugDiv = document.getElementById('debugInfo');
            const infoDiv = document.createElement('div');
            infoDiv.className = 'grid-info';
            infoDiv.textContent = message;
            debugDiv.appendChild(infoDiv);
        }

        function clearResults() {
            document.getElementById('results').innerHTML = '';
            document.getElementById('debugInfo').innerHTML = '';
        }
    </script>
</body>
</html>
