<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Get Wix Media URLs</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            margin-bottom: 20px;
        }
        button {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 12px 24px;
            font-size: 16px;
            border-radius: 4px;
            cursor: pointer;
            margin-bottom: 20px;
        }
        button:hover {
            background: #45a049;
        }
        button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        #results {
            margin-top: 20px;
        }
        .file-item {
            background: #f9f9f9;
            border: 1px solid #ddd;
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 4px;
        }
        .file-item img, .file-item video {
            max-width: 200px;
            max-height: 150px;
            display: block;
            margin: 10px 0;
            border: 1px solid #ddd;
        }
        .url {
            background: #fff;
            border: 1px solid #4CAF50;
            padding: 8px;
            font-family: monospace;
            font-size: 12px;
            word-break: break-all;
            margin: 10px 0;
            border-radius: 3px;
        }
        .copy-btn {
            background: #2196F3;
            padding: 6px 12px;
            font-size: 14px;
            margin-top: 5px;
        }
        .copy-btn:hover {
            background: #0b7dda;
        }
        .error {
            background: #ffebee;
            color: #c62828;
            padding: 15px;
            border-radius: 4px;
            border-left: 4px solid #c62828;
        }
        .info {
            background: #e3f2fd;
            color: #1565c0;
            padding: 15px;
            border-radius: 4px;
            border-left: 4px solid #1565c0;
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üé® Get Wix Media CDN URLs</h1>

        <div class="info">
            <strong>‚ÑπÔ∏è Note:</strong> This tool fetches your Wix Media Manager files and displays their CDN URLs for testing.
            Click "Get My Media Files" to retrieve all available media.
        </div>

        <button id="fetchBtn" onclick="fetchMediaFiles()">üìÅ Get My Media Files</button>

        <div id="results"></div>
    </div>

    <script type="module">
        import { WIX_CONFIG } from '../js/config/wix-config.js';

        window.fetchMediaFiles = async function() {
            const resultsDiv = document.getElementById('results');
            const fetchBtn = document.getElementById('fetchBtn');

            resultsDiv.innerHTML = '<p>Loading...</p>';
            fetchBtn.disabled = true;

            try {
                // Prepare auth header
                const authHeader = WIX_CONFIG.apiKey.startsWith('IST.')
                    ? `Bearer ${WIX_CONFIG.apiKey}`
                    : WIX_CONFIG.apiKey.startsWith('JWS.') ? WIX_CONFIG.apiKey : `Bearer ${WIX_CONFIG.apiKey}`;

                // Note: This will likely fail due to CORS, but we'll try anyway
                const response = await fetch('https://www.wixapis.com/site-media/v1/files', {
                    method: 'GET',
                    headers: {
                        'Authorization': authHeader,
                        'Content-Type': 'application/json',
                        'wix-site-id': WIX_CONFIG.siteId
                    }
                });

                if (!response.ok) {
                    throw new Error(`API returned ${response.status}: ${response.statusText}`);
                }

                const data = await response.json();
                displayResults(data.files || []);

            } catch (error) {
                console.error('Error fetching media:', error);
                resultsDiv.innerHTML = `
                    <div class="error">
                        <strong>‚ùå Error:</strong> ${error.message}
                        <br><br>
                        <strong>Expected Error:</strong> CORS policy blocks this request from browser.
                        <br><br>
                        <strong>üìù Alternative Solutions:</strong>
                        <ul>
                            <li><strong>Option 1:</strong> Go to your Wix Media Manager dashboard, click on any image, and copy its URL</li>
                            <li><strong>Option 2:</strong> Use the manual URL examples below</li>
                            <li><strong>Option 3:</strong> Run the Node.js script (see instructions below)</li>
                        </ul>
                        <br>
                        <strong>üß™ Sample Wix CDN URLs for Testing:</strong>
                        <div class="url" style="margin-top: 10px;">
                            https://static.wixstatic.com/media/11062b_abc123.jpg
                        </div>
                        <div class="url">
                            https://static.wixstatic.com/media/11062b_def456.png
                        </div>
                    </div>
                `;
            } finally {
                fetchBtn.disabled = false;
            }
        };

        function displayResults(files) {
            const resultsDiv = document.getElementById('results');

            if (files.length === 0) {
                resultsDiv.innerHTML = '<div class="info">No media files found in your Media Manager.</div>';
                return;
            }

            let html = `<h2>üìÅ Found ${files.length} Media Files:</h2>`;

            files.forEach((file, index) => {
                const isImage = file.mimeType.startsWith('image/');
                const isVideo = file.mimeType.startsWith('video/');

                html += `
                    <div class="file-item">
                        <strong>${index + 1}. ${file.displayName || file.fileName}</strong>
                        <br>
                        <small>Type: ${file.mimeType} | Size: ${formatFileSize(file.sizeInBytes)}</small>

                        ${isImage ? `<img src="${file.fileUrl}" alt="${file.displayName}">` : ''}
                        ${isVideo ? `<video src="${file.fileUrl}" controls style="max-width: 200px;"></video>` : ''}

                        <div class="url">${file.fileUrl}</div>
                        <button class="copy-btn" onclick="copyToClipboard('${file.fileUrl}', ${index})">
                            üìã Copy URL
                        </button>
                        <span id="copied-${index}" style="color: green; margin-left: 10px; display: none;">‚úÖ Copied!</span>
                    </div>
                `;
            });

            resultsDiv.innerHTML = html;
        }

        function formatFileSize(bytes) {
            if (bytes < 1024) return bytes + ' B';
            if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(1) + ' KB';
            return (bytes / (1024 * 1024)).toFixed(1) + ' MB';
        }

        window.copyToClipboard = async function(text, index) {
            try {
                await navigator.clipboard.writeText(text);
                const copiedMsg = document.getElementById(`copied-${index}`);
                copiedMsg.style.display = 'inline';
                setTimeout(() => {
                    copiedMsg.style.display = 'none';
                }, 2000);
            } catch (err) {
                alert('Failed to copy. Please select and copy manually.');
            }
        };
    </script>
</body>
</html>
